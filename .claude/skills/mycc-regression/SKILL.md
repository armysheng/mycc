---
name: mycc-regression
description: 对 mycc 多用户后端与前端进行回归/冒烟验证。用于“联调验证”“回归测试”“冒烟测试”“验证 403/401 提示”“验证多用户登录与会话隔离”等请求。
---

# mycc-regression

执行 mycc 的标准回归验证流程，优先复用现有服务与脚本，输出可执行结论。

## 触发词

- "回归验证"
- "冒烟测试"
- "联调验证"
- "验证错误提示"
- "验证 403 / 401"
- "验证多用户"

## 执行原则

1. 先验证服务可用，再跑接口链路。
2. 默认不修改业务数据；仅在用户明确要求时重置额度。
3. 出现失败时给出“失败点 + 下一步命令”，避免笼统结论。

## 快速执行（接口回归）

```bash
bash .claude/skills/mycc-regression/scripts/run_regression.sh \
  --credential "<手机号或邮箱>" \
  --password "<密码>" \
  --api-url "http://localhost:8080" \
  --web-url "http://localhost:3000"
```

该脚本会验证：
- 前端/后端健康检查
- 登录获取 token
- `/api/auth/me` 鉴权
- `/api/chat` SSE 流返回

## UI 回归（Playwright）

当用户要求“页面效果是否正确/错误提示是否明显”时，执行：

1. 打开 `http://localhost:3000`
2. 登录测试用户
3. 发送消息并验证：
   - 正常路径：工具消息与 thinking 样式符合预期
   - 异常路径：403/401 时出现“系统错误”样式，且包含原始错误

推荐优先检查：
- 错误卡片是否红色
- 标签是否为“系统错误”
- 文案是否包含“原始错误: ...”

## 常见失败与处理

- `Failed to fetch`
  - 原因：前后端未启动、端口错误、CORS
  - 处理：先检查 `http://localhost:3000` 和 `http://localhost:8080/health`

- `额度已用完`
  - 原因：`tokens_used >= tokens_limit`
  - 处理：按用户指示重置测试用户额度，或提高测试环境配额

- `无权访问该会话`
  - 原因：使用了其他用户的 `sessionId`
  - 处理：新建会话再测

## 输出模板

输出回归结果时使用：

- 通过项：列出已验证的功能点
- 失败项：列出失败接口/页面与原始错误
- 建议项：给出下一步最短修复路径
